<!DOCTYPE html><html lang="ko" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>조이시티 모바일 서비스 Web API의 인증 방식에 대한 고민 · 안녕 프로그래밍</title><meta name="description" content="안녕 프로그래밍"><meta name="og:title" content="조이시티 모바일 서비스 Web API의 인증 방식에 대한 고민"><meta name="og:type" content="website"><meta name="og:url" content="https://www.holaxprogramming.com/2013/01/10/blahblah-study-in-web-api/"><meta name="og:image" content="http://image.toast.com/aaaaahq/hola_cover.JPG"><meta name="og:description" content="안녕 프로그래밍"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/chiangmai.css"><meta name="steem:author" content="@stunstunstun"><meta name="fb:app_id" content="1258629384258634"><link rel="search" type="application/opensearchdescription+xml" href="https://www.holaxprogramming.com/atom.xml" title="안녕 프로그래밍"></head><body class="post"><div id="fb-root"></div><div class="wrap"><header><nav class="navi-post"><a class="navi-post-back" href="javascript:history.back()"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="navi-post-home" href="/"><i class="fa fa-home" aria-hidden="true"></i></a></nav></header><main class="post"><div class="post"><article class="post-block"><h1 class="post-title">조이시티 모바일 서비스 Web API의 인증 방식에 대한 고민</h1><div class="post-info"><div class="post-info-profile"><a href="https://github.com/stunstunstun" target="_blank"><img src="/image/profile.jpg"></a></div><div class="post-info-details"><div class="post-categories"><a href="/categories/blahblah" target="_self"><span>BLAHBLAH</span></a></div><div class="post-date">2013년 1월 10일</div></div></div><div class="post-share"><div class="fb-like" data-href="https://www.holaxprogramming.com/2013/01/10/blahblah-study-in-web-api/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false">                 </div><div class="fb-share-button" data-href="https://www.holaxprogramming.com/2013/01/10/blahblah-study-in-web-api/" data-layout="button" data-size="small" data-mobile-iframe="true"></div><div class="fb-follow" data-href="https://www.facebook.com/holaxprogramming/" data-layout="button_count" data-size="small" data-show-faces="true"></div></div><div class="post-content"><p>조이시티의 프리스타일 풋볼의 모바일 앱 개발을 위해 클라이언트 사이드에서 사용하기 위한 Web API를 개발 하게 됐다. 아무래도 사내 서비스 영역에서 웹 클라이언트(Browser) 또는 <code>Server-To-Server</code>를 위한 API 만을 개발 해왔기 때문에 모바일 환경에서의 통신을 위해 고려해야 될 사항은 무엇일까? 라는 생각이 필요해 보인다.</p>
<p>구체적인 내용보다는 먼저 스케치 단계의 생각들을 간단히 요약해보자.</p>
<h4 id="클라이언트에-어떠한-형식으로-데이터를-전달-할-것인가"><a href="#클라이언트에-어떠한-형식으로-데이터를-전달-할-것인가" class="headerlink" title="클라이언트에 어떠한 형식으로 데이터를 전달 할 것인가?"></a>클라이언트에 어떠한 형식으로 데이터를 전달 할 것인가?</h4><p>Android 그리고 iOS의 네이티브 앱에서 API를 사용하기 위해서는 웹기반의 API와 마찬가지로 XML or JSON 형태로 데이터를 요청하거나 처리 하면 좋을 듯 하다.</p>
<p>여기에 API의 각 요청에서 공통적으로 제공하는 응답 형태가 필요해 보인다. HTTP 응답은 아래와 같이 일관적인 형태의 코드와 메시지를 전달해주는 방식을 고민해볼만 하다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"result"</span>: &lt;object&gt;,</span><br><span class="line"><span class="attr">"errorCode"</span>: &lt;integer&gt;,</span><br><span class="line"><span class="attr">"message"</span>: &lt;string&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>그리고 브라우저 기반의 클라이언트를 위한 API와의 차이점이라면 모바일 디바이스 정보를 수집하는 일도 중요해 보인다. 아래와 같이 말이다.</p>
<ul>
<li>모바일 기기의 OS (Android, iOS, Windows Mobile)</li>
<li>OS의 Version</li>
<li>기기의 고유 식별번호</li>
</ul>
<p>이를 위해서 HTTP 스펙에서 기본적으로 제공하는 Header 값을 참조할 만하다.</p>
<h4 id="사용자-인증-및-API-요청에-대한-권한에-대한-체크는-어떻게-할-것-인가"><a href="#사용자-인증-및-API-요청에-대한-권한에-대한-체크는-어떻게-할-것-인가" class="headerlink" title="사용자 인증 및 API 요청에 대한 권한에 대한 체크는 어떻게 할 것 인가?"></a>사용자 인증 및 API 요청에 대한 권한에 대한 체크는 어떻게 할 것 인가?</h4><p>웹 기반에서는 보통 Cookie 또는 Session을 활용해 도메인 단위로 사용자의 정보를 암&amp;복호화해 인증을 하고 각 요청에 권한 체크를 하였다. 하지만 이렇게 구현된 인증 방식은 웹 기반의 환경에서만 국한되기 쉽기 때문에 이러한 방식보다는 OAuth 스펙의 인증 방식을 고려해볼만 하다.</p>
<p>인증 서버 구현에 비용이 많이 드는 <code>OAuth 1.0a</code> 보다는 SSL을 이용한 <code>OAuth 2.0</code> 기반의 인증 방식을 이용해 클라이언트에 <code>accessToken</code> 과 <code>refreshToken</code> 를 발급하고 이러한 정보를 이용해 API 요청에 대한 권한을 체크하는 방향이 좋아보인다. HTTP 요청의 헤더 값에 아래와 같이 인증을 위한 토큰 정보를 첨부하는 것을 예시로 들 수 있다.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-H "Authorization: &lt;accessToken&gt;"</span><br></pre></td></tr></table></figure>
<h4 id="인증-및-API-요청에-따른-다양한-상황에서-발생되는-예외는-어떻게-처리할-것이고-어떠한-방식으로-효율적으로-예외-또는-에러에-대한-정보를-전달-할-것인가"><a href="#인증-및-API-요청에-따른-다양한-상황에서-발생되는-예외는-어떻게-처리할-것이고-어떠한-방식으로-효율적으로-예외-또는-에러에-대한-정보를-전달-할-것인가" class="headerlink" title="인증 및 API 요청에 따른 다양한 상황에서 발생되는 예외는 어떻게 처리할 것이고, 어떠한 방식으로 효율적으로 예외 또는 에러에 대한 정보를 전달 할 것인가?"></a>인증 및 API 요청에 따른 다양한 상황에서 발생되는 예외는 어떻게 처리할 것이고, 어떠한 방식으로 효율적으로 예외 또는 에러에 대한 정보를 전달 할 것인가?</h4><p>기본적으로 Web API는 예상치 못한 요청으로 인해 애플리케이션 단위에서 런타임 오류가 발생할 경우가 있는데 이 경우에는 기존의 개발 방식을 재사용해도 문제는 없어 보인다. 아래와 같이 말이다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"errorCode"</span>: <span class="number">1001</span>,</span><br><span class="line"><span class="attr">"message"</span>: <span class="string">"Invalid requests"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>추가적으로 각 API를 구현하기 위한 Controller에서 각각의 예외 처리를 하기는 보다는 공통적으로 발생되는 예외에 대한 처리를 하는 클래스를 구현하는 것이 좋겠다. 런타임에서 발생할 수 있는 예외케이스를 통해 예외 클래스를 정의하고 애플리케이션 단위에서 예외처리를 하는 방식말이다.</p>
<h4 id="단위-테스트는-어떻게-할것-인가"><a href="#단위-테스트는-어떻게-할것-인가" class="headerlink" title="단위 테스트는 어떻게 할것 인가?"></a>단위 테스트는 어떻게 할것 인가?</h4><p>네이티브 클라이언트의 사용자 입장에서의 단위 테스트 필요하다고 생각한다. 물론 여기에서 테스트 범위는 클라이언트에서의 API 요청에 국한된다. 가장 좋은 방법은 역시 API를 테스트하기 위한 안드로이드 샘플 애플리케이션을 구현하는 것이다.</p>
<p>이 과정에서 Android 환경에서의 테스트의 복잡성에 대해 이해하고 테스트 범위를 분리해 나아가는 것이 중요해보인다. Android의 <code>Dalvik VM</code> 을 통해 테스트 환경이 구성되어야 된다는 점, 이러한 OS 환경에 맞물려 단위 테스트 했을시 속도가 느리다는 단점이 있다. 단위 테스트는 즉각 즉각 빨리 확인하는게 최고! 그래서 앞으로 더 고민해봐야 될 부분 인 것 같다.</p>
<h4 id="마치며"><a href="#마치며" class="headerlink" title="마치며"></a>마치며</h4><p>일단 지금은 머리속에서 생각나는 것을 두서 없이 정리해 보았고, API 설계하고 구현하면서 생산되는 문서를 바탕으로 기회가 되면 다시한번 구현된 내용을 정리해봤으면 좋겠다.</p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2013/01/10/devops-how-to-manage-dbcp/"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="next" href="/2013/01/11/blahblah-i-need-some-place-to-talk/"><i class="fa fa-arrow-right" aria-hidden="true"></i></a></div><ins class="adsbygoogle adsense-bottom" style="display:block;" data-ad-client="ca-pub-6188640546219653" data-ad-slot="6129396565" data-ad-format="auto"></ins><div class="fb-comments-area"><div class="fb-comments" data-href="https://www.holaxprogramming.com/2013/01/10/blahblah-study-in-web-api/" data-width="700" data-numposts="5"></div></div><div class="copyright"><p>© 2012 - 2022 <a href="https://github.com/stunstunstun" target="_blank">Minhyeok Jung</a>. Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/stunstunstun/hexo-theme-chiangmai" target="_blank">hexo-theme-chiangmai</a>.</p></div></footer></div><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({});</script><script>window.fbAsyncInit=function(){FB.init({appId:"1258629384258634",cookie:!0,xfbml:!0,version:"v2.8"}),FB.AppEvents.logPageView()},function(e,n,t){var o,c=e.getElementsByTagName(n)[0];e.getElementById(t)||((o=e.createElement(n)).id=t,o.src="//connect.facebook.net/en_US/sdk.js",c.parentNode.insertBefore(o,c))}(document,"script","facebook-jssdk");</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create','UA-97419941-1','auto');ga('send','pageview');</script></body></html>