<!DOCTYPE html><html lang="ko" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Spring Boot에서 myBatis를 통해 Datasource 연동하기 · 안녕 프로그래밍</title><meta name="description" content="예제 중심의 Spring Boot 시작하기"><meta name="og:title" content="Spring Boot에서 myBatis를 통해 Datasource 연동하기"><meta name="og:type" content="website"><meta name="og:url" content="https://www.holaxprogramming.com/2015/10/18/spring-boot-with-mybatis/"><meta name="og:image" content="http://image.toast.com/aaaaahq/hola_cover.JPG"><meta name="og:description" content="예제 중심의 Spring Boot 시작하기"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/chiangmai.css"><meta name="steem:author" content="@stunstunstun"><meta name="fb:app_id" content="1258629384258634"><link rel="search" type="application/opensearchdescription+xml" href="https://www.holaxprogramming.com/atom.xml" title="안녕 프로그래밍"></head><body class="post"><div id="fb-root"></div><div class="wrap"><header><nav class="navi-post"><a class="navi-post-back" href="javascript:history.back()"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="navi-post-home" href="/"><i class="fa fa-home" aria-hidden="true"></i></a></nav></header><main class="post"><div class="post"><article class="post-block"><h1 class="post-title">Spring Boot에서 myBatis를 통해 Datasource 연동하기</h1><div class="post-info"><div class="post-info-profile"><a href="https://github.com/stunstunstun" target="_blank"><img src="/image/profile.jpg"></a></div><div class="post-info-details"><div class="post-categories"><a href="/categories/spring-boot" target="_self"><span>SPRING-BOOT</span></a></div><div class="post-date">2015년 10월 18일</div></div></div><div class="post-share"><div class="fb-like" data-href="https://www.holaxprogramming.com/2015/10/18/spring-boot-with-mybatis/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false">                 </div><div class="fb-share-button" data-href="https://www.holaxprogramming.com/2015/10/18/spring-boot-with-mybatis/" data-layout="button" data-size="small" data-mobile-iframe="true"></div><div class="fb-follow" data-href="https://www.facebook.com/holaxprogramming/" data-layout="button_count" data-size="small" data-show-faces="true"></div></div><div class="post-content"><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>이 문서에서는 myBatis 를 Spring Boot 애플리케이션에 통합하기 위한 방법을 설명하고자 합니다. myBatis 에서는 Spring 과의 연동을 위한 mybatis-spring 모듈을 제공하고 있으며, 아래의 링크에서 한글화된 메뉴얼도 제공하고 있는 상태입니다.</p>
<ul>
<li><a href="http://mybatis.org/spring/ko/mappers.html" target="_blank" rel="external">http://mybatis.org/spring/ko/mappers.html</a></li>
</ul>
<p>먼서 전통적인 XML기반의 설정을 통해 myBatis를 통합하는 과정을 살펴보고, Spring Boot 애플리케이션에서는 Java Config 를 통해 myBatis를 어떻게 통합하는지, 이어서 여러 DataSource를 관리하기 위해서 필요한 것들은 무엇이 있는지 살펴보도록 하겠습니다.</p>
<ul>
<li>Dependencies</li>
<li>XML Based Configuartion</li>
<li>Spring Boot 에서 Java Config을 통한 설정</li>
<li>Mapper 테스트</li>
<li>Multiple Data Source 관리</li>
</ul>
<h2 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h2><p>myBatis는 내부적은 JDBC를 사용하기 때문에 Spring Boot에서는 아래와 같이 jdbc starter와 myBatis 그리고 myBatis를 Spring 환경에서 손쉽게 연동할수 있도록 도와주는 mybatis-spring을 추가해야 한다.</p>
<h3 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">"org.springframework.boot:spring-boot-starter-jdbc"</span></span><br><span class="line">compile <span class="string">"org.mybatis:mybatis:3.3.0"</span></span><br><span class="line">compile <span class="string">"org.mybatis:mybatis-spring:1.2.3"</span></span><br></pre></td></tr></table></figure>
<h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="DataSource-설정"><a href="#DataSource-설정" class="headerlink" title="DataSource 설정"></a>DataSource 설정</h3><p>먼저 JDBC를 통해 Database Connection을 관리하기 위해서는 DataSource 인터페이스를 사용하기 위한 구현체를 선택해야 하는데,</p>
<p>spring-boot-starter-jdbc 또는 spring-boot-starter-data-jpa 를 추가하면 Spring Boot에서는 DataSource 관리를 위한 구현체로써 tomcat-jdbc(The Tomcat JDBC Pool) 을 default로 제공한다.</p>
<ul>
<li>이 문서에서는 myBatis를 사용하므로 spring-boot-starter-jdbc를 추가하도록 한다.</li>
</ul>
<p><strong>이외에 선택할수 있는 옵션은 다음과 같다.</strong></p>
<ul>
<li><p>가능하다면 Tomcat JDBC Connection Pool을 선택하는것을 가장 추천한다.</p>
</li>
<li><p>HikariCP 역시 가능한 대안이다.</p>
</li>
<li><p>Commons DBCP 역시 선택가능한 옵션이나, Production 에서는 추천하지 않는다.</p>
</li>
<li><p>마지막으로 Commons DBCP2 역시 가능한 대안이다.</p>
</li>
</ul>
<h2 id="XML-Based-Configuartion"><a href="#XML-Based-Configuartion" class="headerlink" title="XML Based Configuartion"></a>XML Based Configuartion</h2><p>먼저 Spring Boot이전에 전통적인 XML을 통해 myBatis를 통합하는 과정을 살펴보도록 하겠다.</p>
<h3 id="Data-Source-설정"><a href="#Data-Source-설정" class="headerlink" title="Data Source 설정"></a>Data Source 설정</h3><p>DataSource의 구현체를 Bean으로 등록하는 과정이다. 여기서는 tomcat-jdbc의 구현체를 통해 DataSource를 설정하였다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">util:properties</span> <span class="attr">id</span>=<span class="string">"dataSourceConfig"</span> <span class="attr">location</span>=<span class="string">"classpath:/properties/datasource.properties"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.apache.tomcat.jdbc.pool.DataSource"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"#&#123;dataSourceConfig['datasource.driverClassName']&#125;"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"#&#123;dataSourceConfig['datasource.url']&#125;"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"#&#123;dataSourceConfig['datasource.userName']&#125;"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"#&#123;dataSourceConfig['datasource.password']&#125;"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialSize"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"50"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"50"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span> <span class="attr">value</span>=<span class="string">"20"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWait"</span> <span class="attr">value</span>=<span class="string">"2000"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Transaction-Manager-설정"><a href="#Transaction-Manager-설정" class="headerlink" title="Transaction Manager 설정"></a>Transaction Manager 설정</h3><p>DataSource에 Transaction 관리를 위한 Manager클래스를 등록하는 과정이다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"globalRollbackOnParticipationFailure"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>dataSource : DataSource Bean을 참조한다.</li>
<li>globalRollbackOnParticipationFailure : #globalRollbackOnParticipationFailure</li>
</ul>
<h3 id="SqlSessionFactoryBean-과-SqlSessionTemplate"><a href="#SqlSessionFactoryBean-과-SqlSessionTemplate" class="headerlink" title="SqlSessionFactoryBean 과 SqlSessionTemplate"></a>SqlSessionFactoryBean 과 SqlSessionTemplate</h3><p>myBatis 는 JdbcTemplate 대신 Connection 객체를 통한 질의를 위해서 SqlSession을 사용한다. 내부적으로 SqlSessionTemplate가 SqlSession을 구현하게 되는데, Thread에서 안전하고 여러개의 Mapper에서 공유할수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- SqlSessionTemplate 은 myBatis 디폴트 구현체인 org.apache.ibatis.session.defaults.DefaultSqlSession 대신 항상 사용된다.</span><br><span class="line">- SqlSessionTemplate 클래스내에 SqlSession 인터페이스 타입의 proxy클래스가 존재한다. 왜냐하면 템플릿은 스프링 트랜잭션의 일부처럼 사용될 수 있고 여러개 주입된 매퍼 클래스에 의해 사용되도록 쓰레드에 안전하다. </span><br><span class="line">- 동일한 애플리케이션에서 두개의 클래스간의 전환은 데이터 무결성 이슈를 야기할수 있다.</span><br></pre></td></tr></table></figure>
<p>SqlSession을 생성하기 위해서는 SqlSessionFactory를 사용하는데 이를 위해서는 아래와 같은 설정이 필요하다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"com.stunstun.spring.repository.entity"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span> <span class="attr">value</span>=<span class="string">"classpath:META-INF/mybatis/mapper/**/*.xml"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:META-INF/mybatis/mybatis-config.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>dataSource : DataSource Bean을 참조한다.</li>
<li>typeAliasesPackage : Aliase는 Mapper가 XML파일에서 사용되어지는 자바타입에 대한 짧은 별칭이다. Aliase에 해당되는 클래스를 스캔하기 위한 패키지를 지정한다.</li>
<li>mapperLocations : Mapper를 스캔하기위한 XML파일경로를 지정한다.</li>
<li>configLocation : myBatis의 설정파일의 경로를 지정한다.</li>
</ul>
<h3 id="Mapper의-등록"><a href="#Mapper의-등록" class="headerlink" title="Mapper의 등록"></a>Mapper의 등록</h3><p>Mapper는 XML에서 아래와 같이 등록할수 있다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userMapper"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperFactoryBean"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperInterface"</span> <span class="attr">value</span>=<span class="string">"com.stunstun.spring.repository.UserMapper"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Mapper-검색"><a href="#Mapper-검색" class="headerlink" title="Mapper 검색"></a>Mapper 검색</h3><p>하나씩 매퍼를 모두 등록할 필요가 없다. 대신 클래스패스를 지정해서 마이바티스 스프링 연동모듈의 자동스캔기능을 사용할 수 있다. XML을 통해 자동스캔을 사용하는데는 아래의 방법이 있다.</p>
<ul>
<li><mybatis:scan> 엘리먼트 사용</mybatis:scan></li>
<li>스프링 XML파일을 사용해서 MapperScannerConfigurer 를 등록</li>
</ul>
<p>myBatis는 아래와 같은 설정을 통해 basePackage 속성에 등록된 패키지 하위의 interface를 자동으로 Mapper로 인식하게 된다.</p>
<h5 id=""><a href="#" class="headerlink" title=""></a><mybatis:scan></mybatis:scan></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mybatis:scan</span> <span class="attr">base-package</span>=<span class="string">"com.stunstun.spring.repository"</span> <span class="attr">factory-ref</span>=<span class="string">"sqlSessionFactory"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="MapperScannerConfigurer"><a href="#MapperScannerConfigurer" class="headerlink" title="MapperScannerConfigurer"></a>MapperScannerConfigurer</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.stunstun.spring.repository"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"sqlSessionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Spring-Boot-에서-Java-Config을-통한-설정"><a href="#Spring-Boot-에서-Java-Config을-통한-설정" class="headerlink" title="Spring Boot 에서 Java Config을 통한 설정"></a>Spring Boot 에서 Java Config을 통한 설정</h2><p>이번에는 전통적인 XML을 통한 설정이 아닌, Spring Boot 애플리케이션에서 Java Config 를 통해 myBatis를 사용하기 위한 설정방법을 알아보도록 하겠다.</p>
<h3 id="Spring-Boot-애플리케이션-설정"><a href="#Spring-Boot-애플리케이션-설정" class="headerlink" title="Spring Boot 애플리케이션 설정"></a>Spring Boot 애플리케이션 설정</h3><p>Spring Boot 애플리케이션은 <strong>@SpringBootApplication</strong> 어노테이션이 정의되어 있는 클래스를 기준으로 컴포넌트를 스캔하게 되어있는데, 내부적으로는 아래와 같은 어노테이션으로 구성되어 있다.</p>
<p>이 중 <strong>@EnableAutoConfiguration</strong> 어노테이션은 Spring Boot에서 자동설정을 가능하게 해주는데, myBatis를 사용하기 위해서는 DataSource에 대한 구현체를 직접등록해야 되기 때문에 아래와 같이 DataSource 및 TransactionManager에 대한 자동설정을 제외하여야 한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>(exclude = &#123; DataSourceTransactionManagerAutoConfiguration.class, DataSourceAutoConfiguration.class &#125;)</span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.stunstun.spring"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBootMybatisExampleApplication</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringBootMybatisExampleApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Data-Source-및-SqlSessionFactoryBean-등록"><a href="#Data-Source-및-SqlSessionFactoryBean-등록" class="headerlink" title="Data Source 및 SqlSessionFactoryBean 등록"></a>Data Source 및 SqlSessionFactoryBean 등록</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Lazy</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = &#123;<span class="string">"com.stunstun.spring.repository"</span>&#125;)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultDatabaseConfig</span> <span class="keyword">extends</span> <span class="title">DatabaseConfig</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span>(destroyMethod = <span class="string">"close"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        org.apache.tomcat.jdbc.pool.DataSource dataSource = <span class="keyword">new</span> org.apache.tomcat.jdbc.pool.DataSource();</span><br><span class="line">        configureDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DataSourceTransactionManager transactionManager = <span class="keyword">new</span> DataSourceTransactionManager(dataSource());</span><br><span class="line">        transactionManager.setGlobalRollbackOnParticipationFailure(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">sqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SqlSessionFactoryBean sessionFactoryBean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        sessionFactoryBean.setDataSource(dataSource());</span><br><span class="line">        sessionFactoryBean.setTypeAliasesPackage(<span class="string">"com.stunstun.spring.repository.entity"</span>);</span><br><span class="line">        sessionFactoryBean.setConfigLocation(applicationContext.getResource(<span class="string">"classpath:META-INF/mybatis/mybatis-config.xml"</span>));</span><br><span class="line">        sessionFactoryBean.setMapperLocations(applicationContext.getResources(<span class="string">"classpath:META-INF/mybatis/mapper/**/*.xml"</span>));</span><br><span class="line">        <span class="keyword">return</span> sessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Mapper-검색-1"><a href="#Mapper-검색-1" class="headerlink" title="Mapper 검색"></a>Mapper 검색</h3><p>Java Config를 통한 Mapper검색을 위해서는 아래와 같이 @MapperScan 어노테이션을 정의해주면 된다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = &#123;<span class="string">"com.stunstun.spring.repository"</span>&#125;)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultDatabaseConfig</span> <span class="keyword">extends</span> <span class="title">DatabaseConfig</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Mapper-테스트"><a href="#Mapper-테스트" class="headerlink" title="Mapper 테스트"></a>Mapper 테스트</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Rollback</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@SpringApplicationConfiguration</span>(classes = SpringBootMybatisExampleApplication.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperTests</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> User entity;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        entity = <span class="keyword">new</span> User();</span><br><span class="line">        entity.setUserName(<span class="string">"stunstun"</span>);</span><br><span class="line">        entity.setPassword(<span class="string">"stunstun"</span>);</span><br><span class="line"> </span><br><span class="line">        userMapper.insert(entity);</span><br><span class="line">        entity = userMapper.selectByUserName(<span class="string">"stunstun"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertAndDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertThat(entity, notNullValue());</span><br><span class="line"> </span><br><span class="line">        User user = userMapper.selectByUserName(<span class="string">"stunstun"</span>);</span><br><span class="line">        userMapper.delete(user);</span><br><span class="line"> </span><br><span class="line">        user = userMapper.selectByUserName(<span class="string">"stunstun"</span>);</span><br><span class="line">        assertThat(user, nullValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>이 포스팅의 글을 통해 Spring Boot에서 myBatis를 연동하면서 부딪힐수 있는 문제를 모두 해결하는데는 제한이 있을수 있어 아래에 Git에 샘플 프로젝트를 첨부하였다.</p>
<ul>
<li><a href="https://github.com/stunstunstun/awesome-spring-boot/" target="_blank" rel="external">https://github.com/stunstunstun/awesome-spring-boot/</a></li>
</ul>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-auto-configuration.html" target="_blank" rel="external">https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-auto-configuration.html</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto-data-access.html" target="_blank" rel="external">https://docs.spring.io/spring-boot/docs/current/reference/html/howto-data-access.html</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto-database-initialization.html" target="_blank" rel="external">https://docs.spring.io/spring-boot/docs/current/reference/html/howto-database-initialization.html</a></li>
<li><a href="http://mybatis.org/spring/apidocs/reference/" target="_blank" rel="external">http://mybatis.org/spring/apidocs/reference/</a></li>
<li><a href="http://mybatis.org/spring/ko/mappers.html" target="_blank" rel="external">http://mybatis.org/spring/ko/mappers.html</a></li>
<li><a href="http://mybatis.org/mybatis-3/ko/index.html" target="_blank" rel="external">http://mybatis.org/mybatis-3/ko/index.html</a></li>
<li><a href="https://github.com/mybatis/spring/pull/40" target="_blank" rel="external">https://github.com/mybatis/spring/pull/40</a><br><a href="http://mybatis.org/spring/apidocs/reference/org/mybatis/spring/mapper/MapperScannerConfigurer.html" target="_blank" rel="external">http://mybatis.org/spring/apidocs/reference/org/mybatis/spring/mapper/MapperScannerConfigurer.html</a></li>
<li><a href="https://github.com/mybatis/spring/releases" target="_blank" rel="external">https://github.com/mybatis/spring/releases</a></li>
<li><a href="https://github.com/mybatis/spring/issues/58" target="_blank" rel="external">https://github.com/mybatis/spring/issues/58</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2015/10/16/spring-boot-with-jdbc/"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="next" href="/2015/11/12/spring-boot-mybatis-typehandler/"><i class="fa fa-arrow-right" aria-hidden="true"></i></a></div><ins class="adsbygoogle adsense-bottom" style="display:block;" data-ad-client="ca-pub-6188640546219653" data-ad-slot="6129396565" data-ad-format="auto"></ins><div class="fb-comments-area"><div class="fb-comments" data-href="https://www.holaxprogramming.com/2015/10/18/spring-boot-with-mybatis/" data-width="700" data-numposts="5"></div></div><div class="copyright"><p>© 2012 - 2022 <a href="https://github.com/stunstunstun" target="_blank">Minhyeok Jung</a>. Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/stunstunstun/hexo-theme-chiangmai" target="_blank">hexo-theme-chiangmai</a>.</p></div></footer></div><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({});</script><script>window.fbAsyncInit=function(){FB.init({appId:"1258629384258634",cookie:!0,xfbml:!0,version:"v2.8"}),FB.AppEvents.logPageView()},function(e,n,t){var o,c=e.getElementsByTagName(n)[0];e.getElementById(t)||((o=e.createElement(n)).id=t,o.src="//connect.facebook.net/en_US/sdk.js",c.parentNode.insertBefore(o,c))}(document,"script","facebook-jssdk");</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create','UA-97419941-1','auto');ga('send','pageview');</script></body></html>