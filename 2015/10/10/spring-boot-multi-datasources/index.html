<!DOCTYPE html><html lang="ko" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Spring Boot 애플리케이션에서 2개 이상의 Datasource 운용하기 · 안녕 프로그래밍</title><meta name="description" content="예제 중심의 Spring Boot 시작하기"><meta name="og:title" content="Spring Boot 애플리케이션에서 2개 이상의 Datasource 운용하기"><meta name="og:type" content="website"><meta name="og:url" content="https://www.holaxprogramming.com/2015/10/10/spring-boot-multi-datasources/"><meta name="og:image" content="http://image.toast.com/aaaaahq/hola_cover.JPG"><meta name="og:description" content="예제 중심의 Spring Boot 시작하기"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/chiangmai.css"><meta name="steem:author" content="@stunstunstun"><meta name="fb:app_id" content="1258629384258634"><link rel="search" type="application/opensearchdescription+xml" href="https://www.holaxprogramming.com/atom.xml" title="안녕 프로그래밍"></head><body class="post"><div id="fb-root"></div><div class="wrap"><header><nav class="navi-post"><a class="navi-post-back" href="javascript:history.back()"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="navi-post-home" href="/"><i class="fa fa-home" aria-hidden="true"></i></a></nav></header><main class="post"><div class="post"><article class="post-block"><h1 class="post-title">Spring Boot 애플리케이션에서 2개 이상의 Datasource 운용하기</h1><div class="post-info"><div class="post-info-profile"><a href="https://github.com/stunstunstun" target="_blank"><img src="/image/profile.jpg"></a></div><div class="post-info-details"><div class="post-categories"><a href="/categories/spring-boot" target="_self"><span>SPRING-BOOT</span></a></div><div class="post-date">2015년 10월 10일</div></div></div><div class="post-share"><div class="fb-like" data-href="https://www.holaxprogramming.com/2015/10/10/spring-boot-multi-datasources/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false">                 </div><div class="fb-share-button" data-href="https://www.holaxprogramming.com/2015/10/10/spring-boot-multi-datasources/" data-layout="button" data-size="small" data-mobile-iframe="true"></div><div class="fb-follow" data-href="https://www.facebook.com/holaxprogramming/" data-layout="button_count" data-size="small" data-show-faces="true"></div></div><div class="post-content"><h4 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h4><p>애플리케이션 개발시에 단일DB에 Connection을 맺는것이 아니라 아래와 같이 둘이상의 DB와 Connection을 맺어야 할수가 있다.</p>
<ul>
<li>Master / Slave DB를 구분하여 Connection을 맺어야 할때</li>
<li>2개이상의 서로다른 DB를 애플리케이션에서 운용해야 할때</li>
<li>이외의 스케일아웃에 대한 이슈로 인해 애플리케이션에서 복수의 DataSource를 운용해야 할때</li>
</ul>
<p>아래와 같은 순서로 Spring Boot 애플리케이션에서 myBatis연동시 2개이상의 DataSource를 관리하는 방법을 살펴보도록 하자</p>
<ul>
<li>Dependencies 설정</li>
<li>복수의 DataSource 설정</li>
<li>myBatis 설정</li>
<li>Mapper 인터페이스 정의</li>
<li>테스트</li>
</ul>
<h4 id="Dependencies-설정"><a href="#Dependencies-설정" class="headerlink" title="Dependencies 설정"></a>Dependencies 설정</h4><p>myBatis는 내부적은 JDBC를 사용하기 때문에 Spring Boot에서는 아래와 같이 jdbc starter와 myBatis 그리고 myBatis를 Spring 환경에서 손쉽게 연동할수 있도록 도와주는 mybatis-spring을 추가해야 한다.</p>
<p><code>Gradle</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compile &quot;org.springframework.boot:spring-boot-starter-jdbc&quot;</span><br><span class="line">compile &quot;org.mybatis:mybatis:3.3.0&quot;</span><br><span class="line">compile &quot;org.mybatis:mybatis-spring:1.2.3&quot;</span><br></pre></td></tr></table></figure>
<p><code>Maven</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.3.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h4 id="복수의-DataSource-설정"><a href="#복수의-DataSource-설정" class="headerlink" title="복수의 DataSource 설정"></a>복수의 DataSource 설정</h4><p>현재 애플리케이션에서는 동일한 DB를 Master 와 Slave 세트로 구성하고 있다고 가정해보자.</p>
<ul>
<li>대용량의 트래픽을 처리하기 위해서는 단일 DB에서 모든 처리를 하는것보다는 INSERT/UPDATE/DELETE 과 같은 비용이 많이 드는 DML은 Master를 통해서</li>
<li>SELECT와 같이 자주발생되는 DML은 Slave를 통해 처리한다면, 보다 효율적으로 한정된 자원을 활용할수 있을것이다.</li>
</ul>
<p>이를 위해서 Spring Boot 애플리케이션에서는 아래와 같이 Master / Slave에 대한 DataSource를 구분해서 정의할 수가 있다. 이후에 다른용도의 DataSource가 추가될수도 있으므로, 확장성을 위해서 DataSource를 설정하는 공통적인 로직은 DatabaseConfig 라는 추상클래스에 정의해보았다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseConfig</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> DataSource <span class="title">dataSource</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configureDataSource</span><span class="params">(org.apache.tomcat.jdbc.pool.DataSource dataSource, DatabaseProperties databaseProperties)</span> </span>&#123;</span><br><span class="line">        dataSource.setDriverClassName(databaseProperties.getDriverClassName());</span><br><span class="line">        dataSource.setUrl(databaseProperties.getUrl());</span><br><span class="line">        dataSource.setUsername(databaseProperties.getUserName());</span><br><span class="line">        dataSource.setPassword(databaseProperties.getPassword());</span><br><span class="line">        dataSource.setMaxActive(databaseProperties.getMaxActive());</span><br><span class="line">        dataSource.setMaxIdle(databaseProperties.getMaxIdle());</span><br><span class="line">        dataSource.setMinIdle(databaseProperties.getMinIdle());</span><br><span class="line">        dataSource.setMaxWait(databaseProperties.getMaxWait());</span><br><span class="line">        dataSource.setTestOnBorrow(<span class="keyword">false</span>);</span><br><span class="line">        dataSource.setTestOnReturn(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(MasterDatabaseProperties.class)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MasterDatabaseConfig</span> <span class="keyword">extends</span> <span class="title">DatabaseConfig</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MasterDatabaseProperties masterDatabaseProperties;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"masterDataSource"</span>, destroyMethod = <span class="string">"close"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        org.apache.tomcat.jdbc.pool.DataSource masterDataSource = <span class="keyword">new</span> org.apache.tomcat.jdbc.pool.DataSource();</span><br><span class="line">        configureDataSource(masterDataSource, masterDatabaseProperties);</span><br><span class="line">        <span class="keyword">return</span> masterDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">(@Qualifier(<span class="string">"masterDataSource"</span>)</span> DataSource masterDataSource) </span>&#123;</span><br><span class="line">        DataSourceTransactionManager transactionManager = <span class="keyword">new</span> DataSourceTransactionManager(masterDataSource);</span><br><span class="line">        transactionManager.setGlobalRollbackOnParticipationFailure(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(SlaveDatabaseProperties.class)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SlaveDatabaseConfig</span> <span class="keyword">extends</span> <span class="title">DatabaseConfig</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SlaveDatabaseProperties slaveDatabaseProperties;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"slaveDataSource"</span>, destroyMethod = <span class="string">"close"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        org.apache.tomcat.jdbc.pool.DataSource slaveDataSource = <span class="keyword">new</span> org.apache.tomcat.jdbc.pool.DataSource();</span><br><span class="line">        configureDataSource(slaveDataSource, slaveDatabaseProperties);</span><br><span class="line">        <span class="keyword">return</span> slaveDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="myBatis-설정"><a href="#myBatis-설정" class="headerlink" title="myBatis 설정"></a>myBatis 설정</h4><p>DataSource에 대한 정의가 완료되었다면, myBatis에서는 구분되는 DataSource를 효율적으로 선택할수 있어야 한다.<br>아래에서는 MasterMyBatisConfig / SlaveMyBatisConfig 클래스에서는 각각 Master/Slave DB에 Connection 하기 위해 적절한 DataSource를 Dependencies하여 SqlSessionFactory Bean을 등록하는것을 볼수있다.</p>
<p><code>@MapperScan의 속성</code></p>
<ul>
<li>basePackages : 등록한 패키지부터 하위패키지의 정의된 Interface를 Mapper Interface로 자동으로 생성한다.</li>
<li>annotationClass : 맵퍼 Interface를 패키지단위로 스캔하는것 뿐만 아니라, 인터페이스 클래스에 정의된 어노테이션을 기준으로 </li>
<li>맵퍼 Interface를 참조하여 생성할수 있는 기능을 지원한다.<ul>
<li>@Master : Master DB에 Connection 하기 위한 DataSource를 활용한다.</li>
<li>@Slave : Slave DB에 Connection 하기 위한 DataSource를 활용한다.</li>
</ul>
</li>
<li>sqlSessionFactoryRef : myBatis에서 복수의 DataSource를 활용하기 위해서 sqlSessionFactoryBean을 명시적으로 지정해줄 필요가 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String BASE_PACKAGE = <span class="string">"com.stunstun.spring.repository"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TYPE_ALIASES_PACKAGE = <span class="string">"com.stunstun.spring.repository.entity"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONFIG_LOCATION_PATH = <span class="string">"classpath:META-INF/mybatis/mybatis-config.xml"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAPPER_LOCATIONS_PATH = <span class="string">"classpath:META-INF/mybatis/mapper/**/*.xml"</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configureSqlSessionFactory</span><span class="params">(SqlSessionFactoryBean sessionFactoryBean, DataSource dataSource)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        PathMatchingResourcePatternResolver pathResolver = <span class="keyword">new</span> PathMatchingResourcePatternResolver();</span><br><span class="line">        sessionFactoryBean.setDataSource(dataSource);</span><br><span class="line">        sessionFactoryBean.setTypeAliasesPackage(TYPE_ALIASES_PACKAGE);</span><br><span class="line">        sessionFactoryBean.setConfigLocation(pathResolver.getResource(CONFIG_LOCATION_PATH));</span><br><span class="line">        sessionFactoryBean.setMapperLocations(pathResolver.getResources(MAPPER_LOCATIONS_PATH));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = MyBatisConfig.BASE_PACKAGE, annotationClass = Master.class, sqlSessionFactoryRef = <span class="string">"masterSqlSessionFactory"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MasterMyBatisConfig</span> <span class="keyword">extends</span> <span class="title">MyBatisConfig</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">masterSqlSessionFactory</span><span class="params">(@Qualifier(<span class="string">"masterDataSource"</span>)</span> DataSource masterDataSource) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SqlSessionFactoryBean sessionFactoryBean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        configureSqlSessionFactory(sessionFactoryBean, masterDataSource);</span><br><span class="line">        <span class="keyword">return</span> sessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = MyBatisConfig.BASE_PACKAGE, annotationClass = Slave.class, sqlSessionFactoryRef = <span class="string">"slaveSqlSessionFactory"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SlaveMyBatisConfig</span> <span class="keyword">extends</span> <span class="title">MyBatisConfig</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">slaveSqlSessionFactory</span><span class="params">(@Qualifier(<span class="string">"slaveDataSource"</span>)</span> DataSource slaveDataSource) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SqlSessionFactoryBean sessionFactoryBean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        configureSqlSessionFactory(sessionFactoryBean, slaveDataSource);</span><br><span class="line">        <span class="keyword">return</span> sessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Mapper-인터페이스-정의"><a href="#Mapper-인터페이스-정의" class="headerlink" title="Mapper 인터페이스 정의"></a>Mapper 인터페이스 정의</h4><p><code>Master DB</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Master</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">selectList</span><span class="params">()</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">selectOne</span><span class="params">(Long id)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">selectByUserName</span><span class="params">(@Param(<span class="string">"userName"</span>)</span> String userName)</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(User user)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Slave DB</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slave</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserReadOnlyMapper</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">selectList</span><span class="params">()</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">selectOne</span><span class="params">(Long id)</span></span>;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">selectByUserName</span><span class="params">(@Param(<span class="string">"userName"</span>)</span> String userName)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="테스트"><a href="#테스트" class="headerlink" title="테스트:"></a>테스트:</h4><p><code>Master DB</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperTests</span> <span class="keyword">extends</span> <span class="title">AbstractTestableContext</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;  </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User entity = <span class="keyword">new</span> User();</span><br><span class="line">        entity.setUserName(<span class="string">"stunstun"</span>);</span><br><span class="line">        entity.setPassword(<span class="string">"stunstun"</span>);</span><br><span class="line">         </span><br><span class="line">        userMapper.insert(entity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Slave DB</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserReadOnlyMapperTests</span> <span class="keyword">extends</span> <span class="title">AbstractTestableContext</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserReadOnlyMapper userReadOnlyMapper;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User entity = userReadOnlyMapper.selectByUserName(<span class="string">"stunstun"</span>);</span><br><span class="line">        assertThat(entity, nullValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><p>이 포스팅의 글을 통해 Spring Boot에서 myBatis를 연동하면서 부딪힐수 있는 문제를 모두 해결하는데는 제한이 있을수 있어 아래에 Git에 샘플 프로젝트를 첨부해보았다.</p>
<blockquote>
<p><a href="https://github.com/stunstunstun/awesome-spring-boot/tree/master/spring-boot-mybatis-multi-example" target="_blank" rel="external">https://github.com/stunstunstun/awesome-spring-boot/tree/master/spring-boot-mybatis-multi-example</a></p>
</blockquote>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><blockquote>
<p><a href="http://www.mybatis.org/spring/ko/sqlsession.html" target="_blank" rel="external">http://www.mybatis.org/spring/ko/sqlsession.html</a><br><a href="https://github.com/mybatis/spring-boot-starter/issues/78" target="_blank" rel="external">https://github.com/mybatis/spring-boot-starter/issues/78</a><br><a href="http://javapapers.com/spring/spring-conditional-annotation/" target="_blank" rel="external">http://javapapers.com/spring/spring-conditional-annotation/</a></p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2015/09/11/devops-api-gateway-authentication/"><i class="fa fa-arrow-left" aria-hidden="true"></i></a><a class="next" href="/2015/10/12/spring-boot-with-github/"><i class="fa fa-arrow-right" aria-hidden="true"></i></a></div><ins class="adsbygoogle adsense-bottom" style="display:block;" data-ad-client="ca-pub-6188640546219653" data-ad-slot="6129396565" data-ad-format="auto"></ins><div class="fb-comments-area"><div class="fb-comments" data-href="https://www.holaxprogramming.com/2015/10/10/spring-boot-multi-datasources/" data-width="700" data-numposts="5"></div></div><div class="copyright"><p>© 2012 - 2022 <a href="https://github.com/stunstunstun" target="_blank">Minhyeok Jung</a>. Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/stunstunstun/hexo-theme-chiangmai" target="_blank">hexo-theme-chiangmai</a>.</p></div></footer></div><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({});</script><script>window.fbAsyncInit=function(){FB.init({appId:"1258629384258634",cookie:!0,xfbml:!0,version:"v2.8"}),FB.AppEvents.logPageView()},function(e,n,t){var o,c=e.getElementsByTagName(n)[0];e.getElementById(t)||((o=e.createElement(n)).id=t,o.src="//connect.facebook.net/en_US/sdk.js",c.parentNode.insertBefore(o,c))}(document,"script","facebook-jssdk");</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create','UA-97419941-1','auto');ga('send','pageview');</script></body></html>